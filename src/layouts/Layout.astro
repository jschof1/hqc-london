---
import '../styles/global.css';
import Footer from '../components/Footer.astro';

import { Schema } from 'astro-seo-schema';

export interface Props {
  title: string;
  description?: string;
}

const { title, description = "High Quality Clean — Luxury home cleaning for discerning London clients." } = Astro.props;

const baseUrl = 'https://highqualityclean.co.uk';
const canonicalUrl = Astro.url ? Astro.url.href : baseUrl;
const defaultImage = `${baseUrl}/images/areas/mayfair.jpg`;
const ServiceAreaNames = [
  'Belgravia',
  'Chelsea',
  'Kensington',
  'Mayfair',
  'Knightsbridge',
  'St John\'s Wood',
  'Hampstead',
  'Primrose Hill',
  'Highgate',
  'Weybridge',
  'Hersham',
  'Walton-on-Thames'
];

const sameAs = [
  'https://www.facebook.com/highqualityclean',
  'https://www.yell.com/biz/high-quality-clean-ltd-london-901756897/',
  'https://www.tiktok.com/@highqualityclean',
  'https://www.linkedin.com/company/high-quality-cleaning/',
  'https://www.instagram.com/highqualitycleanltd/',
  'https://www.bark.com/en/gb/company/high-quality-clean-ltd/LnAX9/'

];

const areaNodes = [
  {
    '@type': 'Area',
    '@id': `${baseUrl}/belgravia`,
    name: 'Belgravia',
    areaType: 'Luxury maintenance cleaning programme',
    description:
      'Weekly upkeep service for maintaining pristine residences between deep cleans, tailored to Central London homes.',
    provider: { '@id': `${baseUrl}/#organization` },
    areaServed: ServiceAreaNames,
    audience: {
      '@type': 'Audience',
      audienceType: 'Discerning homeowners and busy professionals'
    }
  },
  {
    '@type': 'Area',
    '@id': `${baseUrl}/chelsea`,
    name: 'Chelsea',
    areaType: 'Comprehensive deep cleaning programme in Chelsea',
    description:
      'Meticulous deep cleaning with wellness-grade products, designed for luxury interiors that demand elevated detail.',
    provider: { '@id': `${baseUrl}/#organization` },
    areaServed: ServiceAreaNames,
    audience: {
      '@type': 'Audience',
      audienceType: 'Luxury property managers and high-net-worth households'
    }
  },
  {
    '@type': 'Area',
    '@id': `${baseUrl}/kensington`,
    name: 'Kensington',
    areaType: 'Wellness-led premium cleaning programme in Kensington',
    description:
      'Concierge-level, wellness-focused cleaning protocol delivering spa-like calm across exclusive London and Surrey homes.',
    provider: { '@id': `${baseUrl}/#organization` },
    areaServed: ServiceAreaNames,
    audience: {
      '@type': 'Audience',
      audienceType: 'Wellness-focused households and executive residences'
    }
  },
  {
    '@type': 'Area',
    '@id': `${baseUrl}/mayfair`,
    name: 'Mayfair',
    areaType: 'Wellness-led premium cleaning programme in Mayfair',
    description:
      'Concierge-level, wellness-focused cleaning protocol delivering spa-like calm across exclusive London and Surrey homes.',
    provider: { '@id': `${baseUrl}/#organization` },
    areaServed: ServiceAreaNames,
    audience: {
      '@type': 'Audience',
      audienceType: 'Wellness-focused households and executive residences'
    }
  },
  {
    '@type': 'Area',
    '@id': `${baseUrl}/knightsbridge`,
    name: 'Knightsbridge',
    areaType: 'Wellness-led premium cleaning programme in Knightsbridge',
    description:
      'Concierge-level, wellness-focused cleaning protocol delivering spa-like calm across exclusive London and Surrey homes.',
    provider: { '@id': `${baseUrl}/#organization` },
    areaServed: ServiceAreaNames,
    audience: {
      '@type': 'Audience',
      audienceType: 'Wellness-focused households and executive residences'
    }
  },
  {
    '@type': 'Area',
    '@id': `${baseUrl}/st-johns-wood`,
    name: 'St John\'s Wood',
    areaType: 'Wellness-led premium cleaning programme in St John\'s Wood',
    description:
      'Concierge-level, wellness-focused cleaning protocol delivering spa-like calm across exclusive London and Surrey homes.',
    provider: { '@id': `${baseUrl}/#organization` },
    areaServed: ServiceAreaNames,
    audience: {
      '@type': 'Audience',
      audienceType: 'Wellness-focused households and executive residences'
    }
  },
  {
    '@type': 'Area',
    '@id': `${baseUrl}/hampstead`,
    name: 'Hampstead',
    areaType: 'Wellness-led premium cleaning programme in Hampstead',
    description:
      'Concierge-level, wellness-focused cleaning protocol delivering spa-like calm across exclusive London and Surrey homes.',
    provider: { '@id': `${baseUrl}/#organization` },
    areaServed: ServiceAreaNames,
    audience: {
      '@type': 'Audience',
      audienceType: 'Wellness-focused households and executive residences'
    }
  }
];

const offerNodes = areaNodes.map((area) => ({
  '@type': 'Offer',
  '@id': `${area['@id']}-offer`,
  itemOffered: { '@id': area['@id'] },
  url: `${baseUrl}/#quote`,
  availability: 'https://schema.org/InStock',
  description: `Arrange ${area.name} with a bespoke proposal from High Quality Clean.`
}));

const offerCatalogNode = {
  '@type': 'OfferCatalog',
  '@id': `${baseUrl}/#offer-catalog`,
  name: 'High Quality Clean areas',
  itemListElement: offerNodes.map((offer, index) => ({
    '@type': 'ListItem',
    position: index + 1,
    item: { '@id': offer['@id'] }
  }))
};

const organizationNode = {
  '@type': ['LocalBusiness', 'CleaningService'],
  '@id': `${baseUrl}/#organization`,
  name: 'High Quality Clean',
  alternateName: 'High Quality Clean',
  url: baseUrl,
  description,
  image: defaultImage,
  logo: `${baseUrl}/favicon.ico`,
  email: 'sales@highqualityclean.co.uk',
  telephone: '+44 20 3342 5260',
  priceRange: '£££',
  address: {
    '@type': 'PostalAddress',
    addressLocality: 'London',
    addressRegion: 'Greater London',
    postalCode: 'SW1',
    addressCountry: 'GB'
  },
  areaServed: ServiceAreaNames,
  sameAs,
  contactPoint: [
    {
      '@type': 'ContactPoint',
      contactType: 'Customer Service',
      telephone: '+44 20 3342 5260',
      email: 'sales@highqualityclean.co.uk',
      areaServed: ServiceAreaNames,
      availableLanguage: ['English']
    }
  ],
  aggregateRating: {
    '@type': 'AggregateRating',
    ratingValue: '5',
    bestRating: '5',
    ratingCount: 97
  },
  award: ['ISO 9001 Certified', 'DBS Checked Team', '97+ Five-star Reviews'],
  founder: {
    '@type': 'Person',
    name: 'Pedro',
    jobTitle: 'Founder',
    description:
      'Luxury hospitality professional and wellness cleaning specialist leading High Quality Clean.',
    knowsAbout: [
      'Luxury home cleaning',
      'Wellness-grade protocols',
      'Concierge service',
      'Quality management'
    ]
  },
  hasOfferCatalog: { '@id': offerCatalogNode['@id'] },
  makesOffer: offerNodes.map((offer) => ({ '@id': offer['@id'] }))
};

const websiteNode = {
  '@type': 'WebSite',
  '@id': `${baseUrl}/#website`,
  url: baseUrl,
  name: 'High Quality Clean',
  description,
  inLanguage: 'en-GB',
  publisher: { '@id': organizationNode['@id'] },
  potentialAction: {
    '@type': 'SearchAction',
    target: `${baseUrl}/?s={search_term_string}`,
    'query-input': 'required name=search_term_string'
  }
};

const webpageNode = {
  '@type': 'WebPage',
  '@id': `${canonicalUrl}#webpage`,
  url: canonicalUrl,
  name: title,
  description,
  isPartOf: { '@id': websiteNode['@id'] },
  inLanguage: 'en-GB',
  primaryImageOfPage: defaultImage,
  about: { '@id': organizationNode['@id'] }
};

const schemaItem = {
  '@context': 'https://schema.org',
  '@graph': [
    websiteNode,
    offerCatalogNode,
    organizationNode,
    webpageNode,
    ...areaNodes,
    ...offerNodes
  ]
};
---

<!DOCTYPE html>
<html lang="en">
  <head>
    <!-- Meta -->
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, viewport-fit=cover"
    />
    <meta name="description" content={description} />
    <meta name="robots" content="index, follow" />
    <meta name="googlebot" content="index, follow" />
    <meta name="bingbot" content="index, follow" />
    <meta name="yandexbot" content="index, follow" />
    <meta name="google" content="notranslate" />
    <meta name="google" content="notranslate" />
    <link rel="icon" href="/favicon.ico" />
    <link rel="sitemap" href="/sitemap-index.xml" />
    <title>{title}</title>
    <script defer src="https://cloud.umami.is/script.js" data-website-id="95c24898-5333-41ef-8fbf-a17bcac067af"></script>
    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:wght@500;600&family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet" />
    <!-- FontAwesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css" integrity="sha512-Kc323vGBEqzTmouAECnVceyQqyqdsSiqLQISBL29aUW4U/M7pSPA/gEUZQqv1cwx4OnYxTxve5UMg5GT6L4JJg==" crossorigin="anonymous" referrerpolicy="no-referrer">
    <Schema item={schemaItem} />
  </head>
  <body class="bg-mist text-ink font-display antialiased">
    <slot />
    <Footer />
    <script src="../scripts/main.js"></script>
    <script is:inline>
      // Load Keak script after user interaction to prevent flashing
      (function() {
        let keakLoaded = false;
        let interactionOccurred = false;
        
        function loadKeakScript() {
          if (keakLoaded || document.getElementById('keak-script')) {
            keakLoaded = true;
            return;
          }
          
          const script = document.createElement('script');
          script.id = 'keak-script';
          script.src = 'https://zzontar2hsjaawcn.public.blob.vercel-storage.com/scripts/domain-402-httpshighqualityclean.co.uk.js';
          script.setAttribute('data-domain', '402');
          script.defer = true;
          document.head.appendChild(script);
          keakLoaded = true;
        }
        
        // Load after user interaction (scroll, click, touch, keypress)
        function handleInteraction() {
          if (!interactionOccurred) {
            interactionOccurred = true;
            // Small delay after interaction to ensure page is stable
            setTimeout(loadKeakScript, 100);
          }
        }
        
        // Listen for various user interactions
        ['scroll', 'click', 'touchstart', 'keydown'].forEach(eventType => {
          document.addEventListener(eventType, handleInteraction, { once: true, passive: true });
        });
        
        // Fallback: Load after a delay if no interaction occurs
        // This ensures the script still loads for analytics purposes
        document.addEventListener('astro:page-load', () => {
          setTimeout(() => {
            if (!interactionOccurred) {
              // Use requestIdleCallback to load when browser is idle
              if ('requestIdleCallback' in window) {
                requestIdleCallback(loadKeakScript, { timeout: 2000 });
              } else {
                setTimeout(loadKeakScript, 2000);
              }
            }
          }, 1000);
        }, { once: false });
        
        // Initial page load fallback
        if (document.readyState === 'complete') {
          setTimeout(() => {
            if ('requestIdleCallback' in window) {
              requestIdleCallback(() => {
                setTimeout(loadKeakScript, 2000);
              }, { timeout: 2000 });
            } else {
              setTimeout(loadKeakScript, 2000);
            }
          }, 1000);
        } else {
          window.addEventListener('load', () => {
            setTimeout(() => {
              if ('requestIdleCallback' in window) {
                requestIdleCallback(() => {
                  setTimeout(loadKeakScript, 2000);
                }, { timeout: 2000 });
              } else {
                setTimeout(loadKeakScript, 2000);
              }
            }, 1000);
          }, { once: true });
        }
      })();
    </script>
  </body>
</html>
